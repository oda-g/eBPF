bpfプログラムの作成と実行(1)(tc)
===============================

準備
----

プログラムのコンパイルには、clang を使用するので、インストール。

::

  $ sudo apt istall clang lib6-dev-i386
  
bpfプログラムの作成と実行
----------------------

バイトコードを直接プログラムすることも可能ではあるが、通常は、C言語で作成する。
clangでbpfのオブジェクトファイルを生成することができる。生成されたプログラムをローダーと呼ばれるプログラムでカーネルにロードすることになる。
bpfプログラムは、プログラムタイプにより、いろいろと約束事があり、異なっている。

* bpfプログラムに渡ってくる引数
* bpfプログラムで使用できるカーネルヘルパー
* bpfプログラムの返り値の意味

bpfプログラムはカーネルにロードしただけでは、動作せず、ロードした後に有効化する必要があるが、その方法もプログラムタイムにより異なる。
プログラムタイプにより、ローダーがある(ものもある)。

* | BPF_PROG_TYPE_SOCKET_FILTER
  | raw socket のfilter(ex. tcpdumpで使用)
* BPF_PROG_TYPE_KPROBE
  kprobe で定義したポイントで eBPF実行
* BPF_PROG_SCHED_CLS
  qdisc で eBPF実行(tc で設定)
* BPF_PROG_TYPE_XDP
  XDP用(ip で設定)

